name: Quality Check

on:
  pull_request:  # Runs on every PR
    branches: [main, master]  # Adjust based on your workflow

jobs:
  quality-check:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Checkout the repository
      - name: Checkout Code
        uses: actions/checkout@v3

      # Step 2: Set up Python
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"

      # Step 3: Install Poetry
      - name: Install Poetry
        uses: snok/install-poetry@v1
        with:
          version: latest

      # Step 4: Install Dependencies
      - name: Install Project Dependencies
        run: |
          poetry install --no-root
          poetry run pip install pip-audit

      # Step 5: Run Quality Check Script
      - name: Run Quality Check Script
        run: |
          chmod +x scripts/code_quality_check.sh
          poetry run ./scripts/code_quality_check.sh llmworkbook
        shell: bash
        continue-on-error: false

      # Step 6: Fail Workflow if Issues Exist
      - name: Quality Check Results
        if: failure()
        run: |
          echo "‚ùå Quality checks failed! Fix the reported issues before merging."
          exit 1
